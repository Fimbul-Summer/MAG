@prefix : <http://semex.sigmanoise.com/r3/life-sim#>.
@prefix diff: <http://www.w3.org/2004/delta#>.
@prefix log: <http://www.w3.org/2000/10/swap/log#> .
@prefix e: <http://eulersharp.sourceforge.net/2003/03swap/log-rules#> .
@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix var: <http://www.w3.org/2000/10/swap/var#>.
@prefix string: <http://www.w3.org/2000/10/swap/string#>.


# 选择语句 log:collectAllIn e:findall

# 用一个图或者一个节点来表示范围
# { ?scope e:findall (?x {?x a :Thing} ?list) } => {:answer :is ?list}.

:my-range  :is [
    :scope var:scope;
    :select var:x;
    :where {var:x a :Thing};
].

# {
#     :my-range :is ?y. 
#     ?y :scope ?s1; 
#         :select ?s2; 
#         :where ?s3. 
#     @forAll var:x.
#     ?s1 e:findall (?s2 ?s3 ?s4)
# } => {:answer :is ?s4}.

# 尝试实现一个py脚本，将图中的形如var:x的转变成?x。 要么就在github上发问。

# 这个脚本无法inline地做到这一点，只能生成一个单独的n3文件。
{{var:x :p :o} :parse-vars ?x } => {:answer :is ?x}.


#{ {var:x :p {:y :q var:o} } log:n3String ?z} => {:n3string :Is ?z}.
{?x :parse-vars ?r} <= {
    ?x log:bound true.
    ?x log:n3String ?str.
    #("echo '~w' > ~w " ?str "./my_pipe" ) e:format ?command.
    #("python parse_vars.py '" ?str "' ./my_pipe" ) string:concatenation ?command.
    ("python parse_vars.py '~w'" ?str) e:format ?command.
    #"T8" log:trace ( ?command ) .
    ?command log:shell ?r.
    #"T8" log:trace ( ?r ) .
    # ?r log:parsedAsN3 ?y. # parseAsN3无法正确地将?x变成变量，而是变成了空白节点

}.