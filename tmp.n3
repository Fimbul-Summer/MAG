@prefix log: <http://www.w3.org/2000/10/swap/log#> .
@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix : <http://semex.sigmanoise.com/r3/life-sim#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix e: <http://eulersharp.sourceforge.net/2003/03swap/log-rules#> .
@prefix list: <http://www.w3.org/2000/10/swap/list#>.
@prefix string: <http://www.w3.org/2000/10/swap/string#>.
@prefix diff: <http://www.w3.org/2004/delta#>.
@prefix var: <http://www.w3.org/2000/10/swap/var#>.
@prefix solid: <http://www.w3.org/ns/solid/terms#>.


:myactions :sem {
    :加点
        a   :动作;
        :条件   {:self :可分配点数 ?x .
                ?x math:greaterThan 0 };
        :参数 ( 
                [id :加点属性 :var ?加点属性; :取值范围 (:智力 :颜值 :体质 :家境)]
                [id :加点数值 :var ?加点数值;]
            ); 
        :变量增量 {:self ?加点属性 ?加点数值};
    .
}.
:self :可分配点数 100.

# [id :my-assignment
#     a :赋值;
#     :var ?x1;
#     :target  {?x1 :p {:s :u :?x2}};
# ].

# { (:测试 100) :var-assign ?g2} => {:assigned :is ?g2}.

:当前动作 a :加点, :接地动作; 
    :加点属性 :体质 ;
    :加点数值 12 .

{
    :当前动作 a ?a.
    :myactions :sem ?x. 
    ?x log:includes {?a a :动作; :参数 ?list. ?a :变量增量 ?g}. 
    ?list list:length 2.
    ?list list:first ?p1; list:last ?p2.
    ?x log:includes {?p1 :var ?q1. ?p2 :var ?q2} .
    :当前动作 ?p1 ?v1; ?p2 ?v2.
    ?q1 log:equalTo ?v1.
    ?q2 log:equalTo ?v2.
} => {:当前动作 :变量增量 ?g}.


:self :体质 7.
#接地动作是不再需要多余参数的动作。
{
    ?x a :接地动作; 
        :变量增量 ?g. 
    ?g log:includes {?s ?p ?o} . 
    ?s ?p ?v. 
    (?v ?o) math:sum ?v2.
} => {
    :当前变化 :n3-patch {
        [
            a solid:InsertDeletePatch;
            solid:where   {};
            solid:inserts {?s ?p ?v2};
            solid:deletes {?s ?p ?v };
        ].
    }
}.



{
    :myaction :sem ?x. 
    ?x log:includes {?a a :动作; :参数 ?list. ?a :影响 ?g}. 
    ?list list:length 1.
    ?list list:first ?p1;
    ?x log:includes {?p1 :var ?q1} .
    ?q1 log:equalTo :智力.
} => {?a :影响 ?g}.