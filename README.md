

# 所有游戏之母(MAG, Mother of All Games)

离散时间下的结构化事件驱动型世界模拟，一个语义游戏引擎。基于[EYE推理器](https://github.com/eyereasoner/eye)和[Notation3语言](https://notation3.org)。




## 一. 安装和使用

需要python环境。
再根据这里的说明https://github.com/eyereasoner/eye，安装swi-prolog 和 eye。
需要能够熟练使用N3语言，入门可以参考[这里](https://notation3.org)。

## 二. 项目介绍
略


## 三. 本体定义的介绍
下面介绍游戏引擎中使用的本体类别的定义，以`人生重开模拟器`为例。

参考./ontology文件夹下的对应n3文件，你既可以自己定义相应类别的新实体，也可以创造新的实体类别。

### 变量

- **变量**完全决定了世界和角色当前的状态。
例如，角色具有性别、年龄、颜值、智力、家境、体质、快乐。

    - **临时变量**是只维持一个时间步的变量。

### 事件和因果

- **事件**可以具有**条件**，说明世界需要满足的状态。只有满足了前提条件，事件才可能发生。

    - 发生具有**概率**。只要条件满足就必然发生的事件称为**必然事件**。 例如`出生`。

    - 具有条件的事件称为**首因事件**或**自发事件**，可以作为因果链条的开端。

    - 有的事件自身没有触发条件，只能作为其他事件或动作的结果而触发，称为**非首因事件**。例如`洪水`只能被`下雨`触发。


- 事件可以具有**影响**，说明了其导致的世界状态的变化。

    - 事件可以具有多个影响，各自具有不同的概率，它们分别独立计算。这称之为**影响分支**。
    - 有4种典型影响：**语句新增**，**语句移除**，**变量增量**，**变量替换**。 
        - 语句新增：新增一个三元组，例如 `:小明  :得了 :感冒.`
        - 语句移除：移除一个三元组。
        - 变量增量：改变一个变量的值。例如 `:小明   :体质   -1.`
        - 变量替换：替换/设定一个变量的值，如果没有就新增。例如 `:小明   :体质   8.`

- 事件可以具有**前因**事件以及相应**概率**，当前因事件发生时，该事件以相应概率发生。
    - 事件可以具有多个前因事件。

- 事件可以具有**后果**事件以及相应**概率**，当该事件发生时，后果事件以相应概率发生。
    - 事件可以具有多个后果事件，各自具有不同的概率，它们分别独立计算。

- 事件可以具有**互斥事件**。互斥事件不能同时发生，这种事件的概率不是独立计算的。算法通过拒绝采样来采样结果，直到满足互斥条件。
    - 事件的多个后果事件可以具有互斥关系。如果所有的后果事件两两间互斥，则称为**后果分支**。例如 `:抛硬币 :后果分支  (:正面 :有时), (:反面 :有时), (:立起 :罕见). `。

- 事件的这种前因后果关系可以记录为**因果**。

- 事件可以构成父子关系。当**子事件**发生的时候，**父事件**一定发生。例如，`生病`是`感冒`的父事件。

- 多个事件可以组成一个**事件链**，它是原先各个事件的子事件。 例如 `:下雨 :洪水 :淹死` 这一系列事件可以组成事件链 "下雨引发了洪水，结果被洪水淹死"。事件链的概率是链中各个事件的概率乘积。

- 多个事件可以组成一个**事件簇**，它是原先事件的父事件。例如`:下雨 :下雪 :台风` 这些事件可以组成一个事件簇 `恶劣天气`。 事件簇的概率由团簇中子事件相应计算。
    - 事件簇的后果事件由其中子事件的后果事件组成。概率相应计算。
    - 事件簇之间的因果关系根据其中子事件相应计算。
    - 事件簇的条件和影响由根据子事件相应计算。

- 事件可以具有**参数**，例如，`生病`事件可以发生在不同的人身上，`得病的人`就是其参数。

### 动作
- 动作具有**条件**，并具有相应的**影响/效果**。
- 更复杂的情况下，动作可能有多种不同的影响，并且有对应的概率率。
- 动作允许带有**参数**。
    - 可以有多个参数，多个参数将按照顺序提示用户输入。
    - 参数可以具有**取值范围**。有两种：一种是有限可数的，以列表形式直接列出；另一种是无限的，需要用户手动输入（例如字符串、数字）。
    - 参数可以具有**约束条件**。一个判定条件。\
    注意区分**动作参数的约束条件**和**动作的条件**的不同。 动作条件是动作允许执行的前提条件，和参数取值无关。
    - 参数可具有各种类型（整数、实数、布尔值、枚举值……）。


### 天赋

- **天赋**既可以直接改变变量（即具有和动作/事件类似的**影响**），也可改变事件和动作本身起作用的方式，称为**元影响**。\
相比动作和事件，天赋造成的影响是持续深远的。\
技术上说，影响作用于静态的状态图，而元影响作用于状态图+动态图。

- 天赋具有**稀有度**。更高稀有度的天赋具有更高的优先级。

### 物品
- **物品**可能直接改变变量，也可能改变事件、动作的作用方式。
- 物品分为**主动物品**和**被动物品**。主动物品需要被主动使用才能生效，被动物品不然。
- 物品分为**消耗品**和**非消耗品**。 消耗品只会生效一次。
- 物品具有**稀有度**。更高稀有度的物品具有更高的优先级。 如果是同稀有度的天赋和物品，则物品优先级更高。

- 物品可以关联地点。

### 事件变量和分支(废弃)
- 有时候，事件之间有依赖关系。例如，只有一年前救了一条狗，一年后它才可能搭救你。\
这时候，需要引入一个特别的变量：事件变量，它表示某个事件已经发生。可能还需要一个变量，代表前置事件触发距离当前的年份/时间窗口。\
另一个可能更好的设计是引入历史，历史是特殊的列表类型的变量。


### 地点？

- 地点可以关联角色和物品. 角色可以自发在地点之间移动，物品不行.
- 地点具有可达关系. 构成一个连通图.
- 地点可能会影响角色的属性，或者影响动作和事件。例如岩浆会致死。例如只有在水里才能划船或遭遇鲨鱼袭击。

### 时间和历史？

例子：时间机器
> 时间机器可以设计为一个模拟器，允许回溯历史状态或预测未来状态。通过保存游戏的快照（snapshot），可以快速恢复到某个时间点。\
这不仅可以用于调试，还可以为玩家提供独特的玩法（如“重开”或“后悔药”）

### 角色？
- 角色是动作的发起者。
- 可以拥有物品和天赋。 如果角色拾取物品，则物品不再和原本的地点关联。
- 可以遭遇事件。
- 可以处于某个地点。
- 不同的角色有不同的基本属性，这构成了世界变量的一部分。比如年龄、性别、个性，或者身高体重出生地阵营。
- 角色可以具有临时状态，比如 中毒，混乱，眩晕，诅咒。

- 角色之间可以具有好感度，具有关系模式（父子、敌人、朋友、爱人……）

- 角色可以具有自传体记忆/主观历史 （历史图的一部分）
- 角色可以具有认知（常识图/共同知识图 + 个人主观认知图）

- 角色可以具有提示词，用于语言模型的角色扮演。



### 故事/剧本？
- 故事是角色、地点、事件等等的一系列非随机的构造。比如侦探推理故事，又比如跑团剧本。


### 规则引擎
规则引擎根据游戏当前状态，计算下一个时间步的状态，包括如下流程：
1. 筛选出符合条件的事件，随机选择其中的1个或几个。
2. 计算变量的变化。
3. 根据物品、天赋的特殊效果，重新校正。其中越高稀有度的物品/天赋的规则优先级越高。
4. 根据动作条件，列出玩家可执行的动作。


## 四. 语言模型的集成（未实现）

### 实体抽象

假设玩家获得了“仙丹”，它可以治愈一切疾病。然后玩家遭遇了事件 “得了感冒“、”得了肺炎“、”得了癌症“、”得了梅毒“ ……都可以因为仙丹的存在而产生病愈的后续事件。如果分别为每个事件都写这些规则，那么之后加入新规则也要再写，很容易忘造成不一致。所以需要进行抽象，抽象出一个概念，叫做`患病`。


### 属性抽象
将布尔变量变成属性。\
例如`住在农村`和`住在城市`可以变成`住址`属性的值。

### 事件的描述
语言模型可以根据事件的相关信息，优化事件的**描述**，例如根据事件的前因后果生成更连贯的描述（不引入新的概念和实体）



### 输入动作解析和新增
可以用自然语言描述你要做的动作，语言模型尝试将其翻译成相应的已经存在的动作及其参数。
如果翻译失败，语言模型会尝试判断动作是否合理。
如果合理，语言模型尝试创建新的动作。


### 创建新实体
语言模型可以根据游戏进程需要，创建新的实体，包括物品、天赋、事件、动作等

### 属性的细化/反涌现
例如原本可能只有一个体质属性同时决定了角色的生死、战斗的胜负。现在可能需要分开成生命值、战斗力两个变量。
则需要指定如何由细粒度的属性计算粗粒度的属性。（涌现）
以及在细粒度属性未知而只有粗粒度属性的情况下，以什么样的概率分布生成细粒度属性（后验概率）。


### 语言模型谓词
例如特定角色收到特定物品作为礼物时候的好感度变化，可以用语言模型谓词来估计。


## 五. Demo
展示上述机制的一个简单小游戏
1. 陈松曾经发给我的密室逃脱+怪兽
2. 时间机器+鹦鹉的故事
3. 传教士+食人族
4. 特德姜的跑团故事
5. 生命游戏
6. 演化博弈 + 博弈机制设计

## 六. 其他
### 和[Inform 7](https://ganelson.github.io/inform-website/)的对比

略

